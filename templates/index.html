<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            background-color: #0071ce;
            background: linear-gradient(179.2deg, rgb(21, 21, 212) 0.9%, rgb(53, 220, 243) 95.5%);
            background-attachment: fixed;
            color: white;
        }

        #titleContainer {
            text-align: center;
            margin-top: 30px; /* Adjust as needed */
            margin-bottom: 20px; /* Adjust as needed */
        }

        #titleContainer h1 {
            font-family: 'Roboto', sans-serif;
            font-size: 36px;
            color: #ffc220; /* Adjust the color as needed */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Add text shadow for elegance */
        }

        form {
            margin-bottom: 20px;
        }

        label, #displayCredit, #displayChecking, #displayPercent{
            font-family: 'Roboto', sans-serif;
            font-size: 16px;
            color: #ffc220; /* Adjust the color as needed */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            display: block;
            margin-bottom: 5px;
        }

        input[type="text"] {
          margin-bottom: 10vh;
          border-right: none;
          border-top: none;
          border-left: none;
          background-color:transparent;
          outline: none;
          color: #ffc220;
          caret-color: white;
        }

        .toggle-button {
            background-color: #ffc220;
            border: none;
            color: white;
            padding: 10px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin-right: 10px; /* Adjust the spacing between buttons */
            transition-duration: 0.4s;
            cursor: pointer;
            border-radius: 8px;
        }

        /* Hover effect */
        .toggle-button:hover {
            background-color: #45a049;
        }

        /* Active state */
        .toggle-button:active {
            background-color: #3e8e41;
            transform: translateY(2px);
        }

        #addRowButton {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #ffc220;
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.4s;
        }

        #addRowButton:hover {
            background-color: #c69000 ;
        }

        #addRowButton:active{
            background-color: #9e7700;
        }
        .row {
            margin-bottom: 10px;
        }

        #submitButton {
          padding: 10px 20px;
          background-color: #ffc220;
          border: none;
          color: white;
          border-radius: 8px;
          cursor: pointer;
          transition: background-color 0.4s;
        }

        .deleteButton {
            background-color: #ff0000;
            border: none;
            color: white;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
            transition-duration: 0.4s;
        }

        .deleteButton:hover {
            background-color: #990000;
        }

        .color-change-btn {
        background-color: #ffc220;
        border: none;
        color: white;
        padding: 10px 24px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin-right: 30px; /* Adjust the spacing between buttons */
        transition-duration: 0.4s;
        cursor: pointer;
        border-radius: 8px;
    }

    /* Hover effect */
    .color-change-btn:hover {
        background-color: #45a049;
    }

    .active {
        background-color: green;
        color: white;
    }



    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Include jQuery UI library -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>
<body>
<div id="titleContainer">
    <h1>Wallet Watchers</h1>
</div>
<div id="QuestionContainer" style="margin: auto; padding: 10px; width: 90%; display: flex; flex-wrap: wrap;">
    <div style="margin-right: 30px; flex: 1; min-width: 100px;">
        <label for="credit">Enter Credit Card Balance:</label>
        <input style="width: 100%;" type="text" id="credit" name="credit">
        <div id="displayCredit"></div>
    </div>

    <div style="margin-right: 30px; flex: 1; min-width: 100px;">
        <label for="checking">Enter Checking Balance:</label>
        <input style="width: 100%;" type="text" id="checking" name="checking">
        <div id="displayChecking"></div>
    </div>

    <div style="margin-left: 40px; margin-right: 40px; flex: 3; min-width: 650px;">
        <label for="percent">Choose your monthly spending percent limit. It can be anything from (1-30%):</label>
        <input style="width: 100%;" type="text" id="percent" name="percent">
        <div id="displayPercent"></div>
    </div>

    <div style="margin-right: 30px; flex: 1; min-width: 200px;">
        <input type="submit" value="Submit" id="submitButton" style="margin-bottom: 16px;">
    </div>
</div>

<div style="display: flex; justify-content: center;">
    <button class="color-change-btn" data-range-type="daily">Daily</button>
    <button class="color-change-btn" data-range-type="weekly">Weekly</button>
    <button class="color-change-btn" data-range-type="monthly">Monthly</button>
</div>

{#<button id="addRowButton">Add Row</button>#}
<div id="tableContainer">
</div>

</body>
<script>
    let spendingLimitRange = "";
    $(document).ready(function () {
        loadRows();
        {#const pollingInterval = setInterval(fetchItemIdAndMakeApiCall, 2000);#}
        function fetchItemIdAndMakeApiCall() {
            $.ajax({
                url: 'http://127.0.0.1:8000/get_item_id', // Adjust URL as necessary
                type: 'GET',
                success: function(response) {
                    var itemId = response.itemId;
                    if (itemId) { // Check if itemId is not empty
                        console.log("Received itemId: ", itemId);
                        // Optionally, stop polling once you receive a valid itemId
                        clearInterval(pollingInterval);
                        $.ajax({
                        url: "https://api.bluecartapi.com/request",
                        type: "GET", // Assuming GET is appropriate for the Bluecat API
                        data: {
                            api_key: "2C52275379AD493D8349055DA160F723",
                            type: "product",
                            delivery_type: "available_in_store",
                            item_id: itemId
                        },
                        success: function(response) {
                            console.log("Response from Bluecat API:", response);
                            // Handle the successful response here
                        },
                        error: function(xhr, status, error) {
                            console.error("Error fetching data from Bluecat API:", error);
                        }
                    });
                    }
                },
                error: function(error) {
                    console.log("Error fetching itemId: ", error);
                }
            });
        }

        $(".color-change-btn").click(function() {
            $(".color-change-btn").removeClass("active");
            $(this).addClass("active");
            spendingLimitRange = $(this).data("range-type");
            console.log("Active spending limit range:", spendingLimitRange);
        });

        $("#balanceForm").submit(function(event) {
            event.preventDefault();

            var creditBalance = $("#credit").val();
            var checkingBalance = $("#checking").val();
            $("#displayCredit").text("Credit Balance: " + creditBalance);
            $("#displayChecking").text("Checking Balance: " + checkingBalance);
            var percentLimit = $("#percent").val();
            var spendingLimit = userSpendingLimit(percentLimit); // Ensure this function is defined and returns a value
            $("#displayPercent").val().checkPercentInput();
            if (spendingLimit !== null) {
                var monthlyLim = spendingLimit;
                var weeklyLim = spendingLimit / 4;
                var dailyLim = spendingLimit / 30;
                console.log(monthlyLim);
                console.log(weeklyLim);
                console.log(dailyLim);
            }

            console.log("Credit Balance: " + creditBalance);
            console.log("Checking Balance: " + checkingBalance);
            // Further actions...
        });

        function userSpendingLimit(percentLimit) {
            var parsedInput = parseFloat(percentLimit);
            if (!isNaN(parsedInput)) {
                // User entered a valid number
                return parsedInput;
            } else {
                alert("Invalid input. Please enter a valid number.");
                return null; // Return null to indicate invalid input
            }
        }


        function addRow() {
            let rowNumber = $('#tableContainer .row').length + 1;
            let newRowHtml = `
            <div class="row">
                <form>
                    <label for="lname">Enter Expense:</label>
                    <input type="text" id="expense" name="expense"><br><br>
                </form>
                <button class="deleteButton">Delete</button>
                <div id="loadingIcon${rowNumber}" style="display: none;" class="loadingIcon"></div>
            </div>
    `;

            // Append the new row to the container
            $('#tableContainer').append(newRowHtml);
        }
    function checkPercentInput() {
        try {
            var percentInput = document.getElementById("percent").value;
            var percent = parseFloat(percentInput);

            if (isNaN(percent)) {
                throw new Error("Please enter a valid number.");
            }

            if (percent <= 0 || percent > 30) {
                throw new Error("Percent value out of bounds (1-30).");
            }

            // If the input is valid, you can handle it accordingly
            console.log("Valid percent input:", percent);
        } catch (error) {
            // Handle the exception, you can log the error or display a message
            console.error("Error:", error.message);
            alert(error.message); // Display an alert for simplicity, you can use a more user-friendly approach
            // Optionally, you can reset the input value or provide feedback to the user
            document.getElementById("percent").value = "";
        }
    }
        $('#addRowButton').click(function () {
            addRow();
            saveRows();
        });

        $('#tableContainer').on('click', '.deleteButton', function () {
            let confirmation = confirm("Are you sure you want to delete this row?");
            if (confirmation) {
                $(this).closest('.row').remove();
                saveRows();
            }
        });

        function saveRows() {
            let rowsHtml = $('#tableContainer').html();
            localStorage.setItem('rowsHtml', rowsHtml);
        }

        // Function to load rows from localStorage
        function loadRows() {
            let savedRows = localStorage.getItem('rowsHtml');
            if (savedRows) {
                $('#tableContainer').html(savedRows);
            }
        }

    });

</script>
</html>